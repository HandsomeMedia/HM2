!function(){"use strict";function e(){c("media/glass.jpg").then(function(e){(h=e).id="glass",h.className="hidden",p.insertAdjacentElement("afterend",h),n(),t("model0"),b.offsetParent?d():b.toggle=function(){return null}})}function t(e){function t(){o.removeEventListener("loadedmetadata",t);var e=Math.min(1,Math.min(o.videoWidth/document.body.clientWidth,o.videoHeight/document.body.clientHeight));v.width=document.body.clientWidth*e,v.height=document.body.clientHeight*e,e=Math.max(v.width/o.videoWidth,v.height/o.videoHeight),v.sx=Math.round((o.videoWidth-v.width/e)/2),v.sy=Math.round((o.videoHeight-v.height/e)/2),v.sw=o.videoWidth-2*v.sx,v.sh=o.videoHeight-2*v.sy,v.ctx=v.getContext("2d")}function n(){o.removeEventListener("canplaythrough",n),o.addEventListener("playing",a),o.play(),setTimeout(function(){f.removeAttribute("class")},1e3)}function a(){function e(){s.ctx.drawImage(o,v.sx,v.sy,v.sw,v.sh,0,0,v.width,v.height),i(),"hidden"===h.className&&v.ctx.drawImage(s,0,0),o.ended?t():requestAnimationFrame(e)}function t(){console.log("extracted "+d+" frames"),document.body.removeChild(o),o=null,s=null,b.toggle(),"extracting"===v.className&&v.removeAttribute("class"),"hidden"===h.className&&v.initMotion(!0)}o.removeEventListener("playing",a);var n,i,s=document.createElement("canvas");s.width=v.width,s.height=v.height,s.ctx=s.getContext("2d"),v.className="extracting","function"==typeof createImageBitmap?i=function(){createImageBitmap(s).then(function(e){r[d++]=e})}:(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var a=atob(this.toDataURL(t,n).split(",")[1]),i=a.length,o=new Uint8Array(i),s=0;s<i;s++)o[s]=a.charCodeAt(s);e(new Blob([o],{type:t||"image/png"}))}}),i=function(){s.toBlob(function(e){function t(e){e.target.removeEventListener("load",t),URL.revokeObjectURL(e.target.url),delete e.target.url}(n=document.createElement("img")).url=URL.createObjectURL(e),n.addEventListener("load",t),n.src=n.url,r[d++]=n},"image/jpeg",.7)}),requestAnimationFrame(e)}var i,o=document.createElement("video"),r=[],d=0,l=Math.PI/180,c=180/Math.PI,m=.75,g=0,E=1,y=0;v.className=f.className="hidden",0!==L&&(s(),history.replaceState(null,"Home")),o.hidden=!0,o.muted=!0,o.playsInline=!0,o.preload="auto",o.addEventListener("loadedmetadata",t),o.addEventListener("canplaythrough",n),window.matchMedia("(max-height: 960px)").matches?o.src="media/"+e+"_lo.mp4":o.src="media/"+e+".mp4",document.body.appendChild(o),o.load(),v.toggleFreeze=function(e){e&&"hidden"===h.className?(cancelAnimationFrame(u),v.initMotion(),v.className=f.className=p.className="disabled",h.removeAttribute("class"),b.toggle()):"hidden"!==h.className&&(p.removeAttribute("class"),h.className="hidden","disabled"===v.className&&(v.removeAttribute("class"),v.initMotion(),f.removeAttribute("class"),b.toggle()))},v.initMotion=function(e){function t(){if("hidden"!==h.className)f=0;else switch(w.type){case"touch":case"mouse":f=w.x/document.body.clientWidth*d;break;case"gyro":o=w.alpha*l,s=w.beta*l,p=w.gamma*l,n=Math.cos(p)*Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.sin(p),a=Math.asin(n)*c/90,f=(Math.abs((2*m*(a+1)+g)%2-1)*E-y)*d;break;default:f=Math.round(d/2)}Math.abs(f-i)>1?(i=(i*b+f)/(b+1),u=requestAnimationFrame(t)):(i=f,u=null),v.ctx.drawImage(r[Math.floor(i)],0,0)}var n,a,o,s,p,f,b=e?15:5;void 0===i&&(i=d-1),u=requestAnimationFrame(t)}}function n(){function e(n){if(n.clientX)w.type="mouse",addEventListener("mousemove",t);else if(n.alpha)w.type="gyro",w.alpha0=360-n.alpha,addEventListener("deviceorientation",t);else{if(!n.targetTouches)return;w.type="touch",addEventListener("touchstart",t)}removeEventListener("deviceorientation",e),removeEventListener("mousemove",e),removeEventListener("touchstart",e),a(),t(n)}function t(e){switch(w.type){case"mouse":w.x=e.clientX;break;case"gyro":if(Math.abs(w.gamma-e.gamma)<.1)return;w.alpha=(e.alpha+w.alpha0)%360,w.beta=e.beta,w.gamma=e.gamma;break;case"touch":w.x=e.targetTouches[0].clientX}"hidden"!==h.className||u||"extracting"===v.className||"hidden"===v.className||v.initMotion()}addEventListener("deviceorientation",e),addEventListener("mousemove",e),addEventListener("touchstart",e)}function a(){function e(e){0!==e.target.i?4!==L?(v.toggleFreeze(!0),L=e.target.i,setTimeout(i,400),e.isTrusted&&history.pushState({sectionNum:L},"Section "+L)):o():window.location.reload(!0)}switch(w.type){case"mouse":g=new MouseEvent("mousedown",{view:window,bubbles:!0,cancelable:!0});break;case"gyro":case"touch":g=new TouchEvent("touchstart",{view:window,bubbles:!0,cancelable:!0})}E.forEach(function(t,n){t.i=n,t.addEventListener(g.type,e,M)}),y.closeBtn.addEventListener(g.type,function(e){4===L?o():(s(),history.replaceState(null,"Home"))},M)}function i(){var e=C[L];switch(y.tagFilterBtn&&(y.tagFilterBtn.remove(),delete y.tagFilterBtn),y.removeAttribute("class"),L){case 1:!function(){function t(){"hidden"===v.className?v.removeAttribute("class"):v.className="hidden"}function n(n){n&&(u=n.target.url,r(e.itemDiv),y.tagFilterBtn.textContent=n.target.textContent,n.target.parentNode===v&&(t(),setTimeout(function(){v.querySelector("button[hidden]").removeAttribute("hidden"),n.target.hidden="true"},300))),"hidden"===y.tagFilterBtn.className&&o(),N.removeAttribute("class"),l(u).then(function(t){N.className="hidden",t.forEach(function(t){(i=document.createElement("div")).className="item",(d=document.createElement("img")).alt=t.title,i.appendChild(d),c(t.field_main_image,d).then(function(e){e.parentNode.className="item visible"}),(s=document.createElement("div")).className="title",s.innerHTML="<h2>"+t.title+'</h2><h3 class="italic">'+t.field_subtitle+"</h3>",i.appendChild(s),(h=document.createElement("button")).id=t.nid,h.className="detailBtn",h.textContent="More Details",h.addEventListener("click",a),i.appendChild(h),i.insertAdjacentHTML("beforeend",t.field_link),e.itemDiv.appendChild(i)})})}function a(a){var i,o,s=a.target.parentNode,d=document.getElementsByClassName("detail")[0],c=document.getElementById("dtlHeader"),h=d.getElementsByClassName("content")[0];y.sectionName.textContent="PROJECT DETAIL",d.parentNode.scrollTop=0,r(c),r(h),y.tagFilterBtn.className="hidden","hidden"!==v.className&&t(),c.bg=document.createElement("div"),c.bg.style.backgroundImage="linear-gradient(to right, #111111, transparent, transparent, #111111), url("+s.firstChild.src+")",c.bg.appendChild(s.getElementsByClassName("title")[0].cloneNode(!0)),c.appendChild(c.bg),d.offsetWidth,d.parentNode.removeAttribute("class"),e.itemDiv.className="itemDiv disabled",L=4,a.isTrusted&&history.pushState({sectionNum:L},"Project Detail"),m(500).then(function(){N.removeAttribute("class")}),Promise.all([l("http://handsomemedia.com/drupal/project/"+a.target.id),m(501)]).then(function(e){var t=e[0][0],a=t.tags.split(","),s=new DOMParser;N.className="hidden",(i=document.createElement("div")).innerHTML='<h4 class="hilite">'+t.field_summary+"</h4><hr>",i.insertAdjacentHTML("beforeend",'<h3 class="hilite block white"><img src="media/linkIco.svg"><span>'+t.field_link+"</span></h3>"),i.insertAdjacentHTML("beforeend",'<h3 class="hilite block white"><img src="media/clientIco.svg"><span>'+t.client+' <span class="gray spacing0">'+t.client_note+"</span></span></h3>"),i.insertAdjacentHTML("beforeend",'<h3 class="hilite block white"><img src="media/techIco.svg"><span>'+t.tech+"</span></h3>"),i.insertAdjacentHTML("beforeend",'<h3 class="hilite block white"><img src="media/tagIco.svg"></h3>'),a.forEach(function(e){(o=document.createElement("button")).textContent=e,o.url=encodeURI("http://handsomemedia.com/drupal/tag/"+e),o.addEventListener("click",n),i.lastChild.appendChild(o)}),h.appendChild(i),h.screenshots=document.createElement("div"),h.screenshots.className="screenshots",h.appendChild(h.screenshots),Array.from(s.parseFromString(t.field_images,"text/html").getElementsByTagName("img")).forEach(function(e){function t(e){e.target.removeEventListener("load",t),e.target.parentNode.removeAttribute("class")}(i=document.createElement("div")).className="hidden",i.appendChild(e),e.addEventListener("load",t),e.src="http://handsomemedia.com"+e.getAttribute("src"),i.insertAdjacentHTML("beforeend",'<h3 class="italic">'+e.getAttribute("alt")+"</h3>"),h.screenshots.appendChild(i)})})}var i,s,d,h,u="http://handsomemedia.com/drupal/projectlist",v=document.createElement("div");y.sectionName.textContent="PROJECTS",y.tagFilterBtn=document.createElement("button"),y.tagFilterBtn.id="tagFilterBtn",y.tagFilterBtn.textContent="All",y.tagFilterBtn.addEventListener(g.type,t,M),y.insertBefore(y.tagFilterBtn,y.sectionName),(h=document.createElement("button")).textContent=y.tagFilterBtn.textContent,h.className="blue",h.hidden="true",h.url=u,h.addEventListener(g.type,n,M),v.appendChild(h),l("http://handsomemedia.com/drupal/taglist").then(function(e){e.forEach(function(e){h=document.createElement("button"),e.name[0]===e.name[0].toUpperCase()&&(h.className="peach"),h.textContent=e.name,h.url="http://handsomemedia.com/drupal/tid/"+e.tid,h.addEventListener(g.type,n,M),v.appendChild(h)})}),v.id="tagDiv",v.className="hidden",y.insertAdjacentElement("beforebegin",v),e.itemDiv=document.createElement("div"),e.itemDiv.className="itemDiv",e.appendChild(e.itemDiv),n()}();break;case 2:!function(){function n(e){t(e.currentTarget.filename)}var a,i,o;N.removeAttribute("class"),y.sectionName.textContent="MENAGERIE",l("http://handsomemedia.com/drupal/modellist").then(function(t){N.className="hidden",t.forEach(function(t){(a=document.createElement("div")).className="item",a.filename=t.filename,a.addEventListener("click",n),(o=document.createElement("img")).alt=t.modelname,a.appendChild(o),c(t.thumb,o).then(function(e){e.parentNode.className="item visible"}),(i=document.createElement("div")).innerHTML="<h2>"+t.modelname+'</h2><h3 class="italic">'+t.desc+"</h3>",a.appendChild(i),e.appendChild(a)})})}();break;case 3:y.sectionName.textContent="CONTACT"}e.removeAttribute("class")}function o(){y.sectionName.textContent="PROJECTS",document.getElementById("detail3d").className="hidden",y.tagFilterBtn.removeAttribute("class"),C[L=1].itemDiv.className="itemDiv"}function s(){switch(y.className="disabled",v.toggleFreeze(!1),C[L].className="hidden",L){case 1:document.getElementById("tagDiv").remove();case 2:r(C[L])}L=0}function r(e){for(;e.lastChild;)e.lastChild.remove()}function d(){function e(){function s(l){r="hidden"===b.className?1:Math.min(1,(l-d)/o),a.y=(a.y0+a.y1*t(r,a.rand)-a.total)%a.total,i.y=(i.y0-i.y1*t(r,i.rand))%i.total,a.style.transform="translateY("+a.y+"px)",i.style.transform="translateY("+i.y+"px)",r<1?n=requestAnimationFrame(s):(n=null,"hidden"!==b.className&&(b.interval=setInterval(function(){u||e()},4e3)))}if(!n){var r,d=performance.now();a.rand=Math.random(),a.y0=a.y,a.y1=50*Math.round(a.rand*(a.children.length/2))+50,i.rand=Math.random(),i.y0=i.y,i.y1=50*Math.round(i.rand*(i.children.length/2))+50,clearInterval(b.interval),n=requestAnimationFrame(s)}}function t(e){var t=e/1-1;return t*t*((s+1)*t+s)+1}var n,a=b.getElementsByTagName("ul")[0],i=b.getElementsByTagName("ul")[1],o=750,s=1.70158;a.total=50*a.children.length,a.appendChild(a.firstChild.cloneNode(!0)),a.y=0,i.total=50*i.children.length,i.appendChild(i.firstChild.cloneNode(!0)),i.y=0,b.toggle=function(){"hidden"===h.className&&"hidden"!==f.className&&"disabled"!==f.className?(b.removeAttribute("class"),b.addEventListener("mousedown",e),e()):(b.className="hidden",clearInterval(b.interval),b.removeEventListener("mousedown",e))}}function l(e){return new Promise(function(t,n){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="json",a.onload=function(){200===a.status?t(a.response):n(console.log("XHR request failed:",a.statusText))},a.onerror=function(){n(console.log("There was a network error."))},a.send()})}function c(e,t){return new Promise(function(n,a){function i(){s.removeEventListener("load",i),s.removeEventListener("error",o),n(s)}function o(){s.removeEventListener("load",i),s.removeEventListener("error",o),a(console.log("There was a network error."))}var s=t||document.createElement("img");s.addEventListener("load",i),s.addEventListener("error",o),s.src=e})}function m(e){return new Promise(function(t,n){setTimeout(t,e)})}var h,u,g,v=document.getElementById("bg"),p=document.getElementById("logo"),f=document.getElementsByTagName("nav")[0],E=[p].concat(Array.from(f.getElementsByTagName("button"))),b=document.getElementById("tagline"),y=document.getElementById("mainHeader"),N=document.getElementById("loading"),C=["home"].concat(Array.from(document.getElementsByTagName("section"))),L=0,w={},M=!1;try{var A=Object.defineProperty({},"passive",{get:function(){M={passive:!0}}});window.addEventListener("test",null,A)}catch(e){console.log("passive event listeners not supported.")}window.addEventListener("popstate",function(e){if(e.state){if(g)switch(e.state.sectionNum){case L:history.replaceState(null,"Home"),s();break;case 4:history.replaceState({sectionNum:1},"Section 1");break;default:E[e.state.sectionNum].dispatchEvent(g)}}else 0!==L&&s()}),Promise.all([c("media/logo.svg"),c("media/logo_extra.svg")]).then(function(t){p.main=t[0],p.main.className="logoMain",p.i=0,p.appendChild(p.main),c("media/logo_media.svg").then(function(e){e.className="logoMedia",y.insertAdjacentElement("afterbegin",e),y.insertAdjacentElement("afterbegin",p.main.cloneNode()),y.closeBtn=y.getElementsByClassName("closeBtn")[0],y.sectionName=y.getElementsByClassName("sectionName")[0]}),p.extra=t[1],p.extra.className="logoExtra",p.appendChild(p.extra),e()})}();