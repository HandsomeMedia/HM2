!function(){"use strict"
function e(e){if(e.state){if(v)switch(e.state.sectionNum){case w:history.replaceState(null,"Home"),r()
break
case 4:history.replaceState({sectionNum:1},"Section 1")
break
default:b[e.state.sectionNum].dispatchEvent(v)}}else 0!==w&&r()}function t(){m("img/glass.jpg").then(function(e){u=e,u.id="glass",u.className="hidden",f.insertAdjacentElement("afterend",u),a(),n("model0"),y.offsetParent?l():y.toggle=function(){return null}})}function n(e){function t(){o.removeEventListener("loadedmetadata",t)
var e=Math.min(1,Math.min(o.videoWidth/document.body.clientWidth,o.videoHeight/document.body.clientHeight))
p.width=document.body.clientWidth*e,p.height=document.body.clientHeight*e,e=Math.max(p.width/o.videoWidth,p.height/o.videoHeight),p.sx=Math.round((o.videoWidth-p.width/e)/2),p.sy=Math.round((o.videoHeight-p.height/e)/2),p.sw=o.videoWidth-2*p.sx,p.sh=o.videoHeight-2*p.sy,p.ctx=p.getContext("2d")}function n(){o.removeEventListener("canplaythrough",n),o.addEventListener("playing",a),o.play(),setTimeout(function(){E.removeAttribute("class")},1e3)}function a(){function e(){r.ctx.drawImage(o,p.sx,p.sy,p.sw,p.sh,0,0,p.width,p.height),i(),"hidden"===u.className&&p.ctx.drawImage(r,0,0),o.ended?t():requestAnimationFrame(e)}function t(){console.log("extracted "+d+" frames"),document.body.removeChild(o),o=null,r=null,y.toggle(),"extracting"===p.className&&p.removeAttribute("class"),"hidden"===u.className&&p.initMotion(!0)}o.removeEventListener("playing",a)
var n,i,r=document.createElement("canvas")
r.width=p.width,r.height=p.height,r.ctx=r.getContext("2d"),p.className="extracting","function"==typeof createImageBitmap?i=function(){createImageBitmap(r).then(function(e){s[d++]=e})}:(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var a=atob(this.toDataURL(t,n).split(",")[1]),i=a.length,o=new Uint8Array(i),s=0;i>s;s++)o[s]=a.charCodeAt(s)
e(new Blob([o],{type:t||"image/png"}))}}),i=function(){r.toBlob(function(e){function t(e){e.target.removeEventListener("load",t),URL.revokeObjectURL(e.target.url),delete e.target.url}n=document.createElement("img"),n.url=URL.createObjectURL(e),n.addEventListener("load",t),n.src=n.url,s[d++]=n},"image/jpeg",.7)}),requestAnimationFrame(e)}var i,o=document.createElement("video"),s=[],d=0,l=Math.PI/180,c=180/Math.PI,m=.75,h=0,v=1,b=0
p.className=E.className="hidden",0!==w&&(r(),history.replaceState(null,"Home")),o.hidden=!0,o.muted=!0,o.playsInline=!0,o.preload="auto",o.addEventListener("loadedmetadata",t),o.addEventListener("canplaythrough",n),window.matchMedia("(max-height: 960px)").matches?o.src="vid/"+e+"_lo.mp4":o.src="vid/"+e+".mp4",document.body.appendChild(o),o.load(),p.toggleFreeze=function(e){e&&"hidden"===u.className?(cancelAnimationFrame(g),p.initMotion(),p.className=E.className=f.className="disabled",u.removeAttribute("class"),y.toggle()):"hidden"!==u.className&&(f.removeAttribute("class"),u.className="hidden","disabled"===p.className&&(p.removeAttribute("class"),p.initMotion(),E.removeAttribute("class"),y.toggle()))},p.initMotion=function(e){function t(){if("hidden"!==u.className)E=0
else switch(M.type){case"touch":case"mouse":E=M.x/document.body.clientWidth*d
break
case"gyro":o=M.alpha*l,r=M.beta*l,f=M.gamma*l,n=Math.cos(f)*Math.sin(o)*Math.sin(r)+Math.cos(o)*Math.sin(f),a=Math.asin(n)*c/90,E=(Math.abs((2*m*(a+1)+h)%2-1)*v-b)*d
break
default:E=Math.round(d/2)}Math.abs(E-i)>1?(i=(i*y+E)/(y+1),g=requestAnimationFrame(t)):(i=E,g=null),p.ctx.drawImage(s[Math.floor(i)],0,0)}var n,a,o,r,f,E,y=e?15:5
void 0===i&&(i=d-1),g=requestAnimationFrame(t)}}function a(){function e(n){if(n.clientX)M.type="mouse",addEventListener("mousemove",t)
else if(n.alpha)M.type="gyro",M.alpha0=360-n.alpha,addEventListener("deviceorientation",t)
else{if(!n.targetTouches)return
M.type="touch",addEventListener("touchstart",t)}removeEventListener("deviceorientation",e),removeEventListener("mousemove",e),removeEventListener("touchstart",e),i(),t(n)}function t(e){switch(M.type){case"mouse":M.x=e.clientX
break
case"gyro":if(Math.abs(M.gamma-e.gamma)<.1)return
M.alpha=(e.alpha+M.alpha0)%360,M.beta=e.beta,M.gamma=e.gamma
break
case"touch":M.x=e.targetTouches[0].clientX}"hidden"!==u.className||g||"extracting"===p.className||"hidden"===p.className||p.initMotion()}addEventListener("deviceorientation",e),addEventListener("mousemove",e),addEventListener("touchstart",e)}function i(){function e(e){4===w?s():(r(),history.replaceState(null,"Home"))}function t(e){return 0===e.target.i?void window.location.reload(!0):4===w?void s():(p.toggleFreeze(!0),w=e.target.i,setTimeout(o,400),void(e.isTrusted&&history.pushState({sectionNum:w},"Section "+w)))}switch(M.type){case"mouse":v=new MouseEvent("mousedown",{view:window,bubbles:!0,cancelable:!0})
break
case"gyro":case"touch":v=new TouchEvent("touchstart",{view:window,bubbles:!0,cancelable:!0})}b.forEach(function(e,n){e.i=n,e.addEventListener(v.type,t,A)}),N.closeBtn.addEventListener(v.type,e,A)}function o(){function e(){function e(e){n(e.currentTarget.filename)}var t,i,o
C.removeAttribute("class"),N.sectionName.textContent="MENAGERIE",c("http://handsomemedia.com/drupal/modellist").then(function(n){C.className="hidden",n.forEach(function(n){t=document.createElement("div"),t.className="item",t.filename=n.filename,t.addEventListener("click",e),o=document.createElement("img"),o.alt=n.modelname,t.appendChild(o),m(n.thumb,o).then(function(e){e.parentNode.className="item visible"}),i=document.createElement("div"),i.innerHTML="<h2>"+n.modelname+'</h2><h3 class="italic">'+n.desc+"</h3>",t.appendChild(i),a.appendChild(t)})})}function t(){function e(){"hidden"===p.className?p.removeAttribute("class"):p.className="hidden"}function t(t){t&&(u=t.target.url,d(a.itemDiv),N.tagFilterBtn.textContent=t.target.textContent,t.target.parentNode===p&&(e(),setTimeout(function(){p.querySelector("button[hidden]").removeAttribute("hidden"),t.target.hidden="true"},300))),"hidden"===N.tagFilterBtn.className&&s(),C.removeAttribute("class"),c(u).then(function(e){C.className="hidden",e.forEach(function(e){i=document.createElement("div"),i.className="item",r=document.createElement("img"),r.alt=e.title,i.appendChild(r),m(e.field_main_image,r).then(function(e){e.parentNode.className="item visible"}),o=document.createElement("div"),o.className="title",o.innerHTML="<h2>"+e.title+'</h2><h3 class="italic">'+e.field_subtitle+"</h3>",i.appendChild(o),l=document.createElement("button"),l.id=e.nid,l.className="detailBtn",l.textContent="More Details",l.addEventListener("click",n),i.appendChild(l),i.insertAdjacentHTML("beforeend",e.field_link),a.itemDiv.appendChild(i)})})}function n(n){var i,o,s=n.target.parentNode,r=document.getElementsByClassName("detail")[0],l=document.getElementById("dtlHeader"),m=r.getElementsByClassName("content")[0]
N.sectionName.textContent="PROJECT DETAIL",r.parentNode.scrollTop=0,d(l),d(m),N.tagFilterBtn.className="hidden","hidden"!==p.className&&e(),l.bg=document.createElement("div"),l.bg.style.backgroundImage="linear-gradient(to right, #111111, transparent, transparent, #111111), url("+s.firstChild.src+")",l.bg.appendChild(s.getElementsByClassName("title")[0].cloneNode(!0)),l.appendChild(l.bg),void r.offsetWidth,r.parentNode.removeAttribute("class"),a.itemDiv.className="itemDiv disabled",w=4,n.isTrusted&&history.pushState({sectionNum:w},"Project Detail"),h(500).then(function(){C.removeAttribute("class")}),Promise.all([c("http://handsomemedia.com/drupal/project/"+n.target.id),h(501)]).then(function(e){var n,a=e[0][0],s=a.tags.split(","),r=new DOMParser
C.className="hidden",i=document.createElement("div"),i.innerHTML='<h4 class="hilite">'+a.field_summary+"</h4><hr>",i.insertAdjacentHTML("beforeend",'<h3 class="hilite block white"><img src="img/linkIco.svg"><span>'+a.field_link+"</span></h3>"),i.insertAdjacentHTML("beforeend",'<h3 class="hilite block white"><img src="img/clientIco.svg"><span>'+a.client+' <span class="gray spacing0">'+a.client_note+"</span></span></h3>"),i.insertAdjacentHTML("beforeend",'<h3 class="hilite block white"><img src="img/techIco.svg"><span>'+a.tech+"</span></h3>"),i.insertAdjacentHTML("beforeend",'<h3 class="hilite block white"><img src="img/tagIco.svg"></h3>'),s.forEach(function(e){o=document.createElement("button"),o.textContent=e,o.url=encodeURI("http://handsomemedia.com/drupal/tag/"+e),o.addEventListener("click",t),i.lastChild.appendChild(o)}),m.appendChild(i),m.screenshots=document.createElement("div"),m.screenshots.className="screenshots",m.appendChild(m.screenshots),n=Array.from(r.parseFromString(a.field_images,"text/html").getElementsByTagName("img")),n.forEach(function(e){function t(e){e.target.removeEventListener("load",t),e.target.parentNode.removeAttribute("class")}i=document.createElement("div"),i.className="hidden",i.appendChild(e),e.addEventListener("load",t),e.src="http://handsomemedia.com"+e.getAttribute("src"),i.insertAdjacentHTML("beforeend",'<h3 class="italic">'+e.getAttribute("alt")+"</h3>"),m.screenshots.appendChild(i)})})}var i,o,r,l,u="http://handsomemedia.com/drupal/projectlist",g="http://handsomemedia.com/drupal/taglist",p=document.createElement("div")
N.sectionName.textContent="PROJECTS",N.tagFilterBtn=document.createElement("button"),N.tagFilterBtn.id="tagFilterBtn",N.tagFilterBtn.textContent="All",N.tagFilterBtn.addEventListener(v.type,e,A),N.insertBefore(N.tagFilterBtn,N.sectionName),l=document.createElement("button"),l.textContent=N.tagFilterBtn.textContent,l.className="blue",l.hidden="true",l.url=u,l.addEventListener(v.type,t,A),p.appendChild(l),c(g).then(function(e){e.forEach(function(e){l=document.createElement("button"),e.name[0]===e.name[0].toUpperCase()&&(l.className="peach"),l.textContent=e.name,l.url="http://handsomemedia.com/drupal/tid/"+e.tid,l.addEventListener(v.type,t,A),p.appendChild(l)})}),p.id="tagDiv",p.className="hidden",N.insertAdjacentElement("beforebegin",p),a.itemDiv=document.createElement("div"),a.itemDiv.className="itemDiv",a.appendChild(a.itemDiv),t()}var a=L[w]
switch(N.tagFilterBtn&&(N.tagFilterBtn.remove(),delete N.tagFilterBtn),N.removeAttribute("class"),w){case 1:t()
break
case 2:e()
break
case 3:N.sectionName.textContent="CONTACT"}a.removeAttribute("class")}function s(){N.sectionName.textContent="PROJECTS",document.getElementById("detail3d").className="hidden",N.tagFilterBtn.removeAttribute("class"),w=1,L[w].itemDiv.className="itemDiv"}function r(){switch(N.className="disabled",p.toggleFreeze(!1),L[w].className="hidden",w){case 1:document.getElementById("tagDiv").remove()
case 2:d(L[w])}w=0}function d(e){for(;e.lastChild;)e.lastChild.remove()}function l(){function e(){function s(l){r="hidden"===y.className?1:Math.min(1,(l-d)/o),a.y=(a.y0+a.y1*t(r,2.5*a.rand)-a.total)%a.total,i.y=(i.y0-i.y1*t(r,2.5*i.rand))%i.total,a.style.transform="translateY("+a.y+"px)",i.style.transform="translateY("+i.y+"px)",1>r?n=requestAnimationFrame(s):(n=null,"hidden"!==y.className&&(y.interval=setInterval(function(){g||e()},4e3)))}if(!n){var r,d=performance.now()
a.rand=Math.random(),a.y0=a.y,a.y1=50*Math.round(a.rand*(a.children.length/2))+50,i.rand=Math.random(),i.y0=i.y,i.y1=50*Math.round(i.rand*(i.children.length/2))+50,clearInterval(y.interval),n=requestAnimationFrame(s)}}function t(e){var t=e/1-1
return t*t*((s+1)*t+s)+1}var n,a=y.getElementsByTagName("ul")[0],i=y.getElementsByTagName("ul")[1],o=750,s=1.70158
a.total=50*a.children.length,a.appendChild(a.firstChild.cloneNode(!0)),a.y=0,i.total=50*i.children.length,i.appendChild(i.firstChild.cloneNode(!0)),i.y=0,y.toggle=function(){"hidden"===u.className&&"hidden"!==E.className&&"disabled"!==E.className?(y.removeAttribute("class"),y.addEventListener("mousedown",e),e()):(y.className="hidden",clearInterval(y.interval),y.removeEventListener("mousedown",e))}}function c(e){return new Promise(function(t,n){var a=new XMLHttpRequest
a.open("GET",e),a.responseType="json",a.onload=function(){200===a.status?t(a.response):n(console.log("XHR request failed:",a.statusText))},a.onerror=function(){n(console.log("There was a network error."))},a.send()})}function m(e,t){return new Promise(function(n,a){function i(){s.removeEventListener("load",i),s.removeEventListener("error",o),n(s)}function o(){s.removeEventListener("load",i),s.removeEventListener("error",o),a(console.log("There was a network error."))}var s=t||document.createElement("img")
s.addEventListener("load",i),s.addEventListener("error",o),s.src=e})}function h(e){return new Promise(function(t,n){setTimeout(t,e)})}var u,g,v,p=document.getElementById("bg"),f=document.getElementById("logo"),E=document.getElementsByTagName("nav")[0],b=[f].concat(Array.from(E.getElementsByTagName("button"))),y=document.getElementById("tagline"),N=document.getElementById("mainHeader"),C=document.getElementById("loading"),L=["home"].concat(Array.from(document.getElementsByTagName("section"))),w=0,M={},A=!1
try{var B=Object.defineProperty({},"passive",{get:function(){A={passive:!0}}})
window.addEventListener("test",null,B)}catch(x){console.log("passive event listeners not supported.")}window.addEventListener("popstate",e),Promise.all([m("img/logo.svg"),m("img/logo_extra.svg")]).then(function(e){f.main=e[0],f.main.className="logoMain",f.i=0,f.appendChild(f.main),m("img/logo_media.svg").then(function(e){e.className="logoMedia",N.insertAdjacentElement("afterbegin",e),N.insertAdjacentElement("afterbegin",f.main.cloneNode()),N.closeBtn=N.getElementsByClassName("closeBtn")[0],N.sectionName=N.getElementsByClassName("sectionName")[0]}),f.extra=e[1],f.extra.className="logoExtra",f.appendChild(f.extra),t()})}()
